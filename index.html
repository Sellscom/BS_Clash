<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sea Battle Clash</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f4f8; margin: 0; padding: 15px; text-align: center; color: #2c3e50; }
        .screen { display: none; flex-direction: column; align-items: center; }
        .active { display: flex; }
        .board { display: grid; grid-template-columns: repeat(10, 1fr); width: min(90vw, 320px); height: min(90vw, 320px); background: white; border: 2px solid #2c3e50; margin: 10px auto; }
        .cell { border: 1px solid #eee; aspect-ratio: 1/1; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .ship { background: #3498db; }
        .hit { background: #e74c3c; color: white; }
        .hit::after { content: "×"; }
        .miss { background: #dcdde1; }
        .miss::after { content: "•"; color: #7f8c8d; }
        button { padding: 16px; margin: 8px; width: 100%; max-width: 280px; border-radius: 12px; border: none; background: #3498db; color: white; font-weight: bold; font-size: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button:active { transform: scale(0.98); opacity: 0.9; }
        #status { font-weight: bold; margin: 10px; min-height: 24px; color: #2980b9; }
        #debug-log { font-size: 9px; color: #e74c3c; margin-top: 20px; text-align: left; overflow-wrap: break-word; }
    </style>
</head>
<body>

    <div id="sc-menu" class="screen active">
        <h1>МОРСКОЙ БОЙ</h1>
        <button onclick="startMode('pve')">ИГРАТЬ С БОТОМ</button>
        <button onclick="startMode('pvp')" style="background:#2ecc71">МУЛЬТИПЛЕЕР (PvP)</button>
        <p style="font-size: 12px; color: #7f8c8d;">Сервер: bs-clash.onrender.com</p>
    </div>

    <div id="sc-game" class="screen">
        <div id="status">ПОДГОТОВКА...</div>
        <div id="eb" class="board"></div>
        <p style="margin: 5px 0; font-size: 14px;">Ваше поле</p>
        <div id="pb" class="board"></div>
        <button onclick="location.reload()" style="background:#95a5a6; margin-top: 20px;">ВЫЙТИ В МЕНЮ</button>
    </div>

    <div id="debug-log"></div>

<script>
    // Логирование для отладки на телефонах
    const debug = (msg) => {
        const log = document.getElementById('debug-log');
        log.innerHTML += `<div>> ${msg}</div>`;
        console.log(msg);
    };

    window.onerror = (m, u, l) => debug(`Ошибка: ${m} (линия ${l})`);

    const tg = window.Telegram ? window.Telegram.WebApp : null;
    if (tg) {
        tg.ready();
        tg.expand();
        debug("Telegram SDK инициализирован");
    }

    // --- АКТУАЛЬНАЯ ССЫЛКА НА ВАШ СЕРВЕР ---
    const SERVER_URL = "https://bs-clash.onrender.com"; 
    
    let socket;
    try {
        socket = io(SERVER_URL, { 
            transports: ['websocket', 'polling'],
            reconnectionAttempts: 5
        });
